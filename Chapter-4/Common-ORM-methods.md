# å¸¸ç”¨çš„çš„ ORM æ–¹æ³•

æ—¢ç„¶ä½¿ç”¨äº† ORM æ¥å®šä¹‰æ•°æ®æ¨¡å‹ï¼Œé‚£ä¹ˆå¦‚ä½•æ¥æ“ä½œæ•°æ®å‘¢ï¼Ÿè¿™å°±è¦ç”¨åˆ° Odoo ORM çš„æ–¹æ³•ï¼Œæ¥ä¸‹æ¥ä»‹ç»å‡ ä¸ªå¸¸ç”¨çš„ ORM æ–¹æ³•ã€‚  

åœ¨ä»‹ç»è¿™äº›æ–¹æ³•ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦è¿›å…¥ Odoo çš„äº¤äº’å¼å‘½ä»¤è¡Œï¼Œè¿›å…¥ odoo_dev ç›®å½•å¹¶è¾“å…¥ä»¥ä¸‹å‘½ä»¤ï¼š  

```shell
$ ./odoo-bin shell -c ./odoorc
```

ğŸ’¡ å»ºè®®åœ¨ä½¿ç”¨ Odoo äº¤äº’å¼å‘½ä»¤è¡Œä¹‹å‰å®‰è£… `IPython`ï¼Œæ–¹ä¾¿è¿›è¡Œä»£ç è¡¥å…¨å’Œä½¿ç”¨ã€‚  
  
âš ï¸ è¿›å…¥å‘½ä»¤è¡Œå‰å¿…é¡»å°†é…ç½®æ–‡ä»¶çš„ `db_name` å‚æ•°é…ç½®æˆå®‰è£…äº† bangumi åº”ç”¨ç›¸åŒçš„æ•°æ®åº“ï¼Œæˆ–ä½¿ç”¨ `-d` å‚æ•°æŒ‡å®šæ•°æ®åº“ã€‚  

åœ¨ä¸Šä¸€ç« èŠ‚æœ‰æåˆ° api æ¨¡å—ä¸­çš„ Environment ç±»ï¼Œæˆ‘ä»¬å°±æ˜¯è¦ç”¨è¿™ä¸ªåˆå§‹åŒ–å‡ºä¸€ä¸ª `env` æ¥æ“ä½œæ•°æ®åº“ï¼Œä¸è¿‡ Odoo å·²ç»åœ¨å¯åŠ¨å‘½ä»¤è¡Œæ—¶å¸®åŠ©æˆ‘ä»¬å°†è¿™ä¸ª env åˆå§‹åŒ–å¥½äº†ã€‚  

```plain
In [1]: env                               
Out[1]: <odoo.api.Environment at 0x108d84438>
```

æˆ‘ä»¬å¯ä»¥åˆ©ç”¨ env æ¥å¾—åˆ°æˆ‘ä»¬çš„æ•°æ®åº“æ¨¡å‹ï¼Œå¹¶ä¸”æ“ä½œæ•°æ®åº“è¡¨ã€‚  

```plain
In [2]: env['bangumi.bangumi']
Out[2]: bangumi.bangumi()
```

æ¥ä¸‹æ¥æˆ‘ä»¬å°†åˆ©ç”¨ä»¥ä¸‹å¸¸è§çš„ ORM æ–¹æ³•æ¥æ“ä½œæˆ‘ä»¬çš„æ•°æ®æ¨¡å‹ã€‚  

âš ï¸ åœ¨ Odoo äº¤äº’å¼å‘½ä»¤è¡Œä¸­å¯¹æ•°æ®è¿›è¡Œï¼Œåˆ›å»ºã€ä¿®æ”¹å’Œåˆ é™¤åå¿…é¡»è¦æ‰§è¡Œ `env.cr.commit()` æ‰ä¼šå°†æ•°æ®æ“ä½œå†™å…¥æ•°æ®åº“ä¸­ã€‚

* **create()**  
    
    `create` æ–¹æ³•ç”¨äºåˆ›å»ºæ¨¡å‹æ•°æ®ï¼Œå‚æ•°å¯ä»¥ä¸º `dict` æˆ– `list` ç±»å‹ï¼Œåˆ›å»ºåä¼šè¿”å›åˆ›å»ºçš„è®°å½•æˆ–è®°å½•é›†ã€‚  
    
    ```plain
    In [3]: env['bangumi.bangumi'].create({'name': 'Fate', 'total': 24})                
    Out[3]: bangumi.bangumi(1,)
    In [4]: env['bangumi.bangumi'].create([{'name': 'SAO', 'total': 24}, {'name': 'Jojo', 'total': 24}])
    Out[4]: bangumi.bangumi(2, 3)
    In [5]: env.cr.commit()
    ```

* **search()**
    
    `search` æ–¹æ³•ç”¨äºæœç´¢å·²å­˜åœ¨çš„æ•°æ®ï¼Œä¸å¤§å¤šæ•° ORM æ¡†æ¶ä¸åŒï¼ŒOdoo æœç´¢æ—¶ä¼ å…¥çš„æ˜¯ä¸€ä¸ª `domain`ï¼Œå®ƒæ˜¯ä¸€ä¸ªåˆ—è¡¨å½¢å¼çš„å‚æ•°ï¼Œåœ¨åé¢çš„ç« èŠ‚ä¼šè¯¦ç»†ä»‹ç»è¿™é‡Œå…ˆä¸åšè®²è§£ã€‚
    é™¤äº† domain å‚æ•°ï¼Œè¿˜æœ‰ `offset`ã€`limit`ã€`order` å’Œ `count`ï¼Œè¿™äº›éƒ½æ˜¯å¯é€‰å­—æ®µã€‚
    
    ```plain
    In [6]: env['bangumi.bangumi'].search([('name', '=', 'Fate')]).name
    Out[6]: 'Fate'
    In [7]: env['bangumi.bangumi'].search([('total', '=', 24)], limit=2)
    Out[7]: bangumi.bangumi(1, 2)
    ```

* **write()**
    
    `write` æ–¹æ³•ç”¨äºä¿®æ”¹æ•°æ®ï¼Œä¼ å…¥å‚æ•°ä¸º `dict` ç±»å‹ï¼Œä¿®æ”¹åä¼šè¿”å›å¸ƒå°”å€¼ `True`ã€‚
    
    ```plain
    In [8]: env['bangumi.bangumi'].search([('name', '=', 'SAO')]).write({'total': 12})
    Out[8]: True
    In [9]: env.cr.commit()
    ```

* **browse()**
    
    `browse` æ–¹æ³•å¯ä»¥é€šè¿‡ `id` ç›´æ¥è¿”å›æ•°æ®æˆ–ç»“æœé›†ï¼Œå‚æ•°å¯ä»¥ä¸º `dict` æˆ– `list` ç±»å‹ã€‚
    
    ```plain
    In [10]: env['bangumi.bangumi'].browse(1)
    Out[10]: bangumi.bangumi(1,)
    In [11]: records = env['bangumi.bangumi'].browse([1, 2, 3])
    In [12]: records                       
    Out[12]: bangumi.bangumi(1, 2, 3)
    ```

* **unlink()**
    
    `unlink` æ–¹æ³•ç”¨äºç”¨äºåˆ é™¤æ•°æ®æˆ–ç»“æœé›†ï¼Œåˆ é™¤åè¿”å›å¸ƒå°”å€¼ `True`ï¼Œç»“æœé›†å¯ä»¥ä¸ºç©ºï¼Œç›¸å½“äºæ²¡æœ‰æ“ä½œã€‚  
    
    ```plain
    In [13]: env['bangumi.bangumi'].search([{'name': 'Jojo'}]).unlink()
    Out[13]: True 
    In [14]: env.cr.commit()
    ```

* **exists()**

    `exists` ç”¨äºè¿‡æ»¤å‡ºæ•°æ®åº“ä¸­ç¡®å®å­˜åœ¨çš„æ•°æ®ï¼Œè¿™ä¸ªç”¨æ³•æ¯”è¾ƒå¥‡ç‰¹éœ€è¦æ³¨æ„ä¸€ä¸‹ã€‚  
    
    åœ¨ä¸Šæ–‡ä¸­æˆ‘ä»¬ç”¨ browse æ–¹æ³•æœç´¢å‡ºäº†è®°å½•é›† `records`ã€‚  
    
    ```plain
    In [15]: records                       
    Out[15]: bangumi.bangumi(1, 2, 3)
    ```
    
    ä½†æ˜¯å®é™…ä¸Š id ä¸º`3`çš„æ•°æ®å·²ç»è¢«æˆ‘ä»¬åˆ é™¤äº†ï¼Œæˆ‘ä»¬ä¸€èˆ¬ä¼šè§‰å¾—éœ€è¦é‡æ–°ä½¿ç”¨ `search` æ–¹æ³•æœç´¢æ•°æ®ï¼Œè¿™é‡Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨ Odoo çš„ exists æ–¹æ³•ï¼Œä»–åªä¼šè¿”å›æ•°æ®åº“ä¸­å­˜åœ¨çš„æ•°æ®æˆ–è®°å½•é›†ã€‚  
    
    ```plain
    In [16]: records.exists()
    Out[16]: bangumi.bangumi(1, 2,)
    ```
    
    åˆ©ç”¨è¿™ä¸ªå‡½æ•°æˆ‘ä»¬å¯ä»¥åœ¨åˆ é™¤äº†ä¸€äº›æ•°æ®åï¼Œç”¨äºåˆ¤æ–­æ•°æ®æˆ–è®°å½•é›†æ˜¯å¦ä¸ºç©ºã€‚  
    
    ```python
    if not records.exists():
        # do something ...
        pass
    ```


